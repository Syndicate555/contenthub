import{a as i,s as c,b as l,d as m}from"./api-ewc4Y26-.js";chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"save-to-tavlo",title:"Save to Tavlo",contexts:["link","page"]})});chrome.contextMenus.onClicked.addListener(async(t,r)=>{if(t.menuItemId==="save-to-tavlo"){const o=t.linkUrl||t.pageUrl||(r==null?void 0:r.url);if(!o){chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-48.png"),title:"Tavlo - Error",message:"No URL found to save"});return}const s=await i();if(!s){chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-48.png"),title:"Tavlo - Not Logged In",message:"Please open the extension and log in first"});return}try{const e=await c(o,void 0,s);e.success?chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-48.png"),title:"Tavlo - Saved Successfully! âœ“",message:e.badges&&e.badges.length>0?`Saved! Earned ${e.badges.length} badge(s)`:"Link saved to your Tavlo library"}):chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-48.png"),title:"Tavlo - Save Failed",message:e.error||"Failed to save. Please try again."})}catch(e){chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-48.png"),title:"Tavlo - Error",message:e instanceof Error?e.message:"Failed to save. Please try again."})}}});chrome.runtime.onMessageExternal.addListener((t,r,o)=>{var s;if(console.log("[Tavlo Extension] Received external message:",t),t.type==="TAVLO_EXTENSION_AUTH"){const{token:e,email:n}=t;if(!e){console.error("[Tavlo Extension] No token in auth message"),o({success:!1,error:"No token provided"});return}return console.log("[Tavlo Extension] Storing auth token for:",n),Promise.all([l(e),n?m(n):Promise.resolve()]).then(()=>{console.log("[Tavlo Extension] Auth token stored successfully"),o({success:!0})}).catch(a=>{console.error("[Tavlo Extension] Error storing token:",a),o({success:!1,error:a.message})}),!0}if(t.type==="TAVLO_EXTENSION_CLOSE_TAB"){console.log("[Tavlo Extension] Received tab close request"),(s=r.tab)!=null&&s.id?(chrome.tabs.remove(r.tab.id).catch(e=>{console.warn("[Tavlo Extension] Could not close tab:",e)}),o({success:!0})):(console.warn("[Tavlo Extension] No tab ID to close"),o({success:!1,error:"No tab ID"}));return}o({success:!1,error:"Unknown message type"})});
