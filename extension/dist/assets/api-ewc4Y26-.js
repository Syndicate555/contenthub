const i={AUTH_TOKEN:"tavlo_auth_token",USER_EMAIL:"tavlo_user_email"};async function g(e){await chrome.storage.sync.set({[i.AUTH_TOKEN]:e})}async function l(){return(await chrome.storage.sync.get(i.AUTH_TOKEN))[i.AUTH_TOKEN]||null}async function m(e){await chrome.storage.sync.set({[i.USER_EMAIL]:e})}async function y(){await chrome.storage.sync.clear()}async function E(){const e=await l();return e!==null&&e.length>0}function f(){return"http://localhost:3000"}function h(){return f()}const u=h(),d=`${u}/api/items/extension`;class o extends Error{constructor(a,n,t){super(a),this.statusCode=n,this.details=t,this.name="ApiError"}}async function p(e,a){const{token:n,...t}=a,s={"Content-Type":"application/json",...t.headers};n&&(s.Authorization=`Bearer ${n}`);try{const r=await fetch(e,{...t,headers:s}),c=await r.json();if(!r.ok)throw new o(c.error||"Request failed",r.status,c.details);return c}catch(r){throw r instanceof o?r:new o(r instanceof Error?r.message:"Network request failed")}}async function w(e){try{return(await fetch(`${u}/api/items`,{method:"GET",headers:{Authorization:`Bearer ${e}`}})).status===200}catch(a){return console.warn("Token validation failed due to network error:",a),!0}}async function T(e,a,n){try{const s=await p(d,{method:"POST",token:n,body:JSON.stringify({url:e,note:a})});return s.ok?{success:!0,item:s.data,badges:s.newBadges}:{success:!1,error:s.error}}catch(t){let s="Failed to save item";return t instanceof o?t.statusCode===401?s="Session expired. Please log in again.":t.statusCode===429?s="Too many saves. Please try again in a few minutes.":(t.statusCode,s=t.message):t instanceof Error&&(s=t.message),{success:!1,error:s}}}export{l as a,g as b,y as c,m as d,f as g,E as i,T as s,w as v};
